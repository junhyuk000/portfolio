{% extends "movie_base.html" %}
{% block css %}
<style>
    #map { width: 100%; height: 500px; }
    #placesList {
        list-style: none;
        padding: 0;
        margin: 10px 0;
        max-height: 200px;
        overflow-y: auto;
    }
    #placesList li {
        margin: 5px 0;
        cursor: pointer;
        padding: 5px;
        border: 1px solid #ddd;
        background: #f9f9f9;
    }
    #placesList li:hover { background: #e0e0e0; }
</style>
{% endblock %}

{% block content %}
<h2>Cinemas Near Me</h2>
<input type="text" id="searchInput" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 300px;">
<button id="searchButton">ê²€ìƒ‰</button>
<div id="map"></div>
<ul id="placesList"></ul>
{% endblock %}
{% block js %}
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=be47724c48a9357381269e671a99079c&libraries=services"></script>
<script src="/popcornapp/static/js/map.js"></script>
<script>
    function loadKakaoMap() {
        if (window.kakao && window.kakao.maps) {
            console.log("ì¹´ì¹´ì˜¤ ë§µ API ì´ë¯¸ ë¡œë“œë¨");
            if (typeof initializeMap === "function") {
                initializeMap(); // ë§µ ì´ˆê¸°í™” ì‹¤í–‰
            } else {
                console.error("âŒ initializeMap í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ");
            }
            return;
        }

        var script = document.createElement("script");
        script.src = "https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_API_KEY&libraries=services";
        script.async = true;
        script.defer = true;

        script.onload = function () {
            console.log("âœ… ì¹´ì¹´ì˜¤ ë§µ API ë¡œë“œ ì™„ë£Œ");
            if (typeof initializeMap === "function") {
                initializeMap();
            } else {
                console.error("âŒ initializeMap í•¨ìˆ˜ê°€ ì—¬ì „íˆ ì •ì˜ë˜ì§€ ì•ŠìŒ");
            }
        };

        script.onerror = function () {
            console.error("ğŸš¨ ì¹´ì¹´ì˜¤ ë§µ API ë¡œë“œ ì‹¤íŒ¨");
            alert("ì¹´ì¹´ì˜¤ ë§µì„ ë¡œë“œí•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.");
        };

        document.head.appendChild(script);
    }

    window.onload = function () {
        console.log("ğŸŒ Window onload ì‹¤í–‰");
        loadKakaoMap();
    };
</script>

{% endblock %}