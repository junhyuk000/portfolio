{% extends 'movie_base.html' %}
{% block css %}
<style>
     /* a íƒœê·¸ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    a {
        color: inherit; /* âœ… ë¶€ëª¨ ìš”ì†Œì˜ ê¸°ë³¸ ê¸€ììƒ‰ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš© */
        text-decoration: none; /* âœ… ë°‘ì¤„ ì œê±° */
        transition: color 0.3s ease-in-out; /* âœ… ë¶€ë“œëŸ¬ìš´ ìƒ‰ìƒ ë³€ê²½ íš¨ê³¼ */
    }

    /* a íƒœê·¸ hover ì‹œ ìƒ‰ìƒ ë³€ê²½ */
    a:hover {
        color: #dda15e; /* âœ… ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ìƒ‰ìƒì´ ë³€ê²½ë¨ */
    }
    .movie-container { 
        display: flex; 
        flex-wrap: wrap; 
        justify-content: center; /* ì¤‘ì•™ ì •ë ¬ */
        gap: 20px; 

    }


    .movie-card { 
        width: 220px; 
        padding: 15px; 
        border: 1px solid #283618; 
        text-align: center;
        background-color: #283618; 
        border-radius: 10px; 
        box-shadow: 8px 8px 10px rgba(0, 0, 0, 0.3); /* âœ… ì˜¤ë¥¸ìª½ ì•„ë˜ ê·¸ë¦¼ì */
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
    }
        /* âœ… ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì‚´ì§ ë” ê°•ì¡° */
    .movie-card:hover {
        transform: scale(1.05);
        box-shadow: 10px 10px 14px rgba(0, 0, 0, 0.5); /* âœ… ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ ì¡°ê¸ˆ ë” ì§„í•œ ê·¸ë¦¼ì */
    }
    .movie-card img { 
        width: 100%; 
        height: 250px; 
        object-fit: cover; 
        border-radius: 8px;
    }
    .lottery-btn { 
        padding: 5px 10px; 
        background-color:  #bc6c25; 
        color: white; 
        border: none; 
        cursor: pointer;
        margin-top: 10px;
        border-radius: 8px;
    }
    .audience { 
        cursor: pointer; 
        border-bottom: 1px dashed wheat; 
    }
</style>
{% endblock %}

{% block content %}
<h2 style="text-align: center;">ğŸ¿ ì˜í™” ì¶”ì²¨</h2>
<div class="movie-container">
    {% for movie in movies %}
    <div class="movie-card">
        <img src="{{ url_for('popcornapp.static', filename='images/' + movie.filename) }}" alt="{{ movie.title }}">
        <p style="color: white;"><a href="/popcornapp/movie_youtube/{{movie.title}}">{{ movie.title }}</a></p>
        <p style="color: wheat;">ğŸ¬ ê°ë…: {{ movie.director }}</p>
        <p style="color: wheat;">â­ í‰ì : {{ movie.rating if movie.rating else 'N/A' }}</p>
        <p style="color: wheat;">ğŸ’¬ ë¦¬ë·°: <a href="/popcornapp/reviews/{{ movie.title }}/{{movie.id}}">{{ movie.reviews if movie.reviews else 0 }}ê°œ</a></p>
        <p style="color: wheat;">
            ğŸ‘ª ê´€ê°ìˆ˜: 
            <span class="audience" title="{{ movie.c_audience }}">
                {{ (movie.c_audience // 10000) | string + 'ë§Œëª…' if movie.c_audience >= 10000 else movie.c_audience|string + 'ëª…' }}
            </span>
        </p>
        <p style="color: wheat;">ğŸ¿ íŒì½˜: {{ movie.popcorns }}</p>
        <button class="lottery-btn" onclick="confirmLottery({{ movie.id }}, '{{ movie.title }}')">ì¶”ì²¨í•˜ê¸°</button>
    </div>
    {% endfor %}
</div>

<script>
    function confirmLottery(movie_id, movie_title) {
        let userConfirm = confirm("ì¶”ì²¨ì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
        if (userConfirm) {
            submitLottery(movie_id, movie_title);
        }
    }

    function submitLottery(movie_id, movie_title) {
        fetch("/popcornapp/movie_popcorns", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ movie_id: movie_id, movie_title: movie_title })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(data.error);  // íŒì½˜ ë¶€ì¡± ë“± ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
            } else {
                alert(data.message);  // ì •ìƒì ìœ¼ë¡œ ì¶”ì²¨ë˜ì—ˆì„ ê²½ìš° ë©”ì‹œì§€ í‘œì‹œ
                location.reload();  // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
            }
        })
        .catch(error => console.error("Error:", error));
    }
</script>


{% endblock %}
